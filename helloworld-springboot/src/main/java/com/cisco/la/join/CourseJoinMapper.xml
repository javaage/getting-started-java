<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cisco.la.join.CourseJoinMapper">
  <resultMap id="BaseResultMap" type="com.cisco.la.model.CourseModel">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Feb 08 14:38:32 CST 2018.
    -->
    <id column="crs_id" jdbcType="INTEGER" property="id" />
    <result column="crs_name" jdbcType="VARCHAR" property="courseName" />
    <result column="crs_price" jdbcType="DOUBLE" property="price" />
    <result column="crs_startdate" jdbcType="DATE" property="startDate" />
    <result column="crs_enddate" jdbcType="DATE" property="endDate" />
    <result column="crs_active" jdbcType="BIT" property="active" />
    <result column="crs_url" jdbcType="VARCHAR" property="url" />
  </resultMap>
  	<select id="getUserCourseListByList" parameterType="map" resultMap="BaseResultMap">
	  SELECT crs_id, crs_name, crs_price, crs_url, crs_startdate, crs_enddate, 
      crs_active
	  FROM la_course c
	  inner join (select usr_id,usr_balance from la_user where usr_id=#{userID}) u
	  on c.crs_price &lt;= u.usr_balance 
	  left join la_crs_history h
  	  on u.usr_id = h.hstr_usr_id
	  where crs_id in 
	  <foreach collection="ids" item="id"  index="index" open="(" close=")" separator=",">
		 #{id}
	  </foreach>
	  and (h.hstr_crs_id is null or c.crs_id != h.hstr_crs_id) 
	</select>
	<select id="getCourseByName" parameterType="String" resultMap="BaseResultMap">
	  SELECT crs_id, crs_name, crs_price, crs_url, crs_startdate, crs_enddate, 
      crs_active
	  FROM la_course 
	  where upper(crs_name) = upper(#{courseName})
	</select>
</mapper>